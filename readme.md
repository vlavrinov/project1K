# Telegram-бот для прогноза погоды

Этот Telegram-бот предоставляет прогноз погоды для заданного маршрута, используя данные AccuWeather API. Бот поддерживает ввод начальной, конечной и промежуточных точек маршрута, а также позволяет выбрать период прогноза (1 или 5 дней) и тип графика для визуализации данных (температура, ветер или осадки).

## Установка и запуск

1. Клонируйте репозиторий:

    ```bash
    git clone https://github.com/vlavrinov/project1K
    ```

2. Установите необходимые библиотеки:

    ```bash
    pip install aiogram==2.25.1 requests plotly pandas
    ```

3. Получите API ключ от AccuWeather ([https://developer.accuweather.com/](https://developer.accuweather.com/)).

4. Получите токен для Telegram-бота у [@BotFather](https://t.me/BotFather).

5. Вставьте ваш API ключ AccuWeather в файл `app.py` в переменную `API_KEY`.

6. Вставьте токен Telegram-бота в файл `bot.py` в переменную `bot` (строка `bot = Bot(token="")`).

7. Запустите бота:

    ```bash
    python bot.py
    ```

## Функциональность

*   Бот поддерживает следующие команды:
    *   `/start` - выводит приветственное сообщение и краткое описание бота.
    *   `/help` - выводит список доступных команд и краткую инструкцию.
    *   `/weather` - запускает процесс запроса прогноза погоды.
*   Также бот поддерживает кнопки **Погода** и **Помощь**
*   **Процесс запроса прогноза погоды:**
    1. Пользователь вводит начальный город.
    2. Пользователь вводит конечный город.
    3. Бот спрашивает, нужно ли добавить промежуточные города.
    4. Если пользователь выбирает "Да", бот запрашивает названия промежуточных городов по одному.
    5. Пользователь выбирает период прогноза (1 или 5 дней).
    6. Пользователь выбирает, хочет ли он построить график.
    7. Если пользователь выбирает "Да", бот запрашивает город и тип данных для графика.
    8. Бот отправляет пользователю текстовый прогноз погоды для всех указанных городов на выбранный период.
    9. Если пользователь выбрал построение графика, бот отправляет изображение графика.
    10. Бот добавляет ссылку на подробный прогноз на сайте AccuWeather.

## Обработка ошибок

*   **Ошибка получения координат города:** Если AccuWeather Location API не может определить координаты города, пользователю выводится сообщение об ошибке.
*   **Ошибка запроса к AccuWeather Forecast API:** Если API недоступно, или произошла другая ошибка при запросе (например, превышен лимит запросов), пользователю выводится сообщение об ошибке.
*   **Ошибка обработки данных от API:** Если данные от API не содержат ожидаемых полей, пользователю выводится сообщение об ошибке.
*   **Ошибка ввода данных пользователем:** Если пользователь не ввел названия городов или ввел некорректные данные, ему выводится соответствующее сообщение об ошибке.

## Используемые библиотеки

*   **aiogram:** Фреймворк для создания Telegram-ботов.
*   **requests:** Для отправки HTTP-запросов к AccuWeather API.
*   **plotly:** Для создания графиков.
*   **pandas:** Для обработки данных.

## Особенности

*   Поддержка промежуточных точек маршрута.
*   Выбор периода прогноза (1 или 5 дней).
*   Построение графиков температуры, скорости ветра и осадков.
*   Кэширование данных о погоде для оптимизации количества запросов к API.
*   Разделение прогноза на несколько сообщений, если он слишком длинный.
*   Добавление ссылки на подробный прогноз на AccuWeather.
*   Использование кнопок для быстрого взаимодействия с ботом

## Тестирование

Для проверки работоспособности бота можно выполнить следующие тесты:

**Юзкейс 1: Корректный ввод данных.**

*   **Входные данные:** `/weather`, "Moscow" как начальный город, "London" как конечный город, "Нет" при добавлении промежуточных городов, "5 дней" как период прогноза, "Да" на вопрос о графике, "Москва", "температура".
*   **Ожидаемый результат:** Текстовый прогноз погоды для Москвы и Лондона на 5 дней, график температуры для Москвы, ссылка на AccuWeather

**Юзкейс 2: Некорректный ввод данных (несуществующий город).**

*   **Входные данные:** `/weather`, "Несуществующийгород" как начальный город, "Moscow" как конечный город.
*   **Ожидаемый результат:** Сообщение "Не удалось определить местоположение для города Несуществующийгород." для несуществующего города, далее запрос прогноза для существующих городов
